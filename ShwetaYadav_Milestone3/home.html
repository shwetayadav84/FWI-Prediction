<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FWI Result — Neon</title>
<style>
  :root{
    --text:#fff; --glass: rgba(255,255,255,0.04);
  }
  html,body{height:100%; margin:0; font-family:Inter,Segoe UI,Roboto,Arial; color:var(--text); overflow:hidden}
  body.low{ background: linear-gradient(135deg,#0b3d1b,#07401f); }
  body.moderate{ background: linear-gradient(135deg,#735f0b,#d79e12); color:#111 }
  body.high{ background: linear-gradient(135deg,#7a2f00,#ff6b00); }
  body.veryhigh{ background: linear-gradient(135deg,#a50f0f,#ff3d00); }
  body.extreme{ background: linear-gradient(135deg,#3b0000,#8b0000); }

  .wrap{ display:flex; align-items:center; justify-content:center; height:100vh; padding:20px; box-sizing:border-box; }
  .card{ width:820px; max-width:95%; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border-radius:16px; padding:26px; box-shadow:0 18px 50px rgba(0,0,0,0.6); border:1px solid var(--glass); backdrop-filter: blur(8px); display:flex; gap:20px; align-items:center; }
  .left{ width:50%; padding:14px }
  .right{ width:50%; padding:14px; text-align:center }

  h1{ margin:0; font-size:28px; text-shadow:0 6px 30px rgba(0,0,0,0.35) }
  .fwi-value{ font-size:64px; margin:8px 0; font-weight:800; letter-spacing:1px; color:#fff; text-shadow:0 18px 60px rgba(0,0,0,0.45) }
  .danger-level{ font-size:22px; margin-bottom:10px; font-weight:700 }

  .gif-box img{ width:320px; border-radius:12px; border:4px solid rgba(255,255,255,0.06); box-shadow:0 18px 60px rgba(0,0,0,0.5) }

  .meter { height:18px; background:rgba(255,255,255,0.08); border-radius:12px; overflow:hidden; margin-top:18px; }
  .meter .bar{ height:100%; width:0%; background:linear-gradient(90deg,#ffef6b,#ff3d00); transition:width 1.6s cubic-bezier(.2,.9,.2,1) }

  .btn-back{ display:inline-block; margin-top:18px; padding:12px 22px; background:rgba(0,0,0,0.35); color:white; border-radius:10px; text-decoration:none }

  .speak-text{ font-size:16px; margin-top:12px; opacity:0.95 }

  @media(max-width:880px){
    .card{ flex-direction:column; padding:18px }
    .left, .right { width:100% }
    .gif-box img{ width:240px }
    .fwi-value{ font-size:48px }
  }
</style>
</head>
<body class="{{ css_class or 'low' }}">
<div class="wrap">
  <div class="card">
    <div class="left">
      <h1> Forest Fire Weather Index</h1>
      {% if error %}
        <p style="color:yellow; font-weight:700">Error: {{ message }}</p>
        <a class="btn-back" href="/">↩ Back</a>
      {% else %}
        <div class="fwi-value">{{ fwi }}</div>
        <div class="danger-level">{{ level }}</div>
        <div class="meter"><div class="bar" id="bar"></div></div>
        <div class="speak-text" id="speakText">{{ voice_text }}</div>
        <a class="btn-back" href="/">↩ Back</a>
      {% endif %}
    </div>

    <div class="right">
      {% if not error %}
        <div class="gif-box"><img src="/static/gifs/{{ gif_file }}" alt="animation"></div>
      {% endif %}
    </div>
  </div>
</div>

{% if not error %}
<audio id="alertSound" src="/static/sounds/{{ sound_file }}" preload="auto"></audio>

<script>
  // guard against missing variables by using Jinja defaults
  const voiceText = "{{ voice_text|replace('"', '\\"') }}";
  const fwiRaw = "{{ fwi }}";
  const fwi = Number(fwiRaw) || 0;

  // speak message
  try {
    const msg = new SpeechSynthesisUtterance(voiceText);
    msg.rate = 1;
    msg.pitch = 1;
    msg.volume = 1;
    setTimeout(()=>{ window.speechSynthesis.speak(msg); }, 600);
  } catch(e){ console.warn("TTS failed:", e); }

  // play alert sound (if permitted by browser)
  const audio = document.getElementById('alertSound');
  setTimeout(()=>{ try{ audio.play(); }catch(e){ console.warn(e); } }, 700);

  // animate meter bar
  const percent = Math.max(3, Math.min(98, (fwi / 60) * 100));
  const barEl = document.getElementById('bar');
  if (barEl) barEl.style.width = percent + '%';

  // typewriter effect for the message
  const speakEl = document.getElementById('speakText');
  if (speakEl){
    let idx = 0;
    const txt = speakEl.textContent || "";
    speakEl.textContent = '';
    function type(){
      if(idx < txt.length){
        speakEl.textContent += txt[idx++];
        setTimeout(type, 22);
      }
    }
    setTimeout(type, 1200);
  }
</script>


{% endif %}

</body>
</html>
